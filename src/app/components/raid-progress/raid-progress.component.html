<div class="raid-progress-container">
  @if (selectedCharacter()) {
    <div class="raid-header">
      <h3>{{ selectedCharacter()!.name }} - Raid Progress</h3>
      <p-badge
        [value]="rewardQuality()"
        [severity]="rewardQuality() === 'Mythic' ? 'danger' : 'warn'"
        size="large">
      </p-badge>
    </div>

    <div class="raid-grid">
      <!-- Vault Progress Card -->
      <p-card header="Great Vault Progress" styleClass="vault-progress-card">
        <div class="vault-summary">
          <div class="vault-slots-display">
            <span class="slots-earned">{{ vaultProgress().slots }}/3</span>
            <span class="slots-label">Vault Slots</span>
          </div>

          <div class="vault-requirements">
            <div class="requirement-item">
              <span class="requirement-count">{{ vaultProgress().completed }}/2</span>
              <span class="requirement-label">First Slot</span>
              <p-badge
                [value]="vaultProgress().completed >= 2 ? '✓' : ''"
                [severity]="getVaultSlotSeverity(0)">
              </p-badge>
            </div>
            <div class="requirement-item">
              <span class="requirement-count">{{ vaultProgress().completed }}/4</span>
              <span class="requirement-label">Second Slot</span>
              <p-badge
                [value]="vaultProgress().completed >= 4 ? '✓' : ''"
                [severity]="getVaultSlotSeverity(1)">
              </p-badge>
            </div>
            <div class="requirement-item">
              <span class="requirement-count">{{ vaultProgress().completed }}/6</span>
              <span class="requirement-label">Third Slot</span>
              <p-badge
                [value]="vaultProgress().completed >= 6 ? '✓' : ''"
                [severity]="getVaultSlotSeverity(2)">
              </p-badge>
            </div>
          </div>
        </div>

        <p-progressBar
          [value]="vaultProgress().percentage"
          [showValue]="false"
          styleClass="vault-progress-bar">
        </p-progressBar>

        @if (vaultProgress().nextMilestone.remaining > 0) {
          <p-message
            severity="info"
            styleClass="milestone-message">
            <span>{{ vaultProgress().nextMilestone.remaining }} more bosses needed for next vault slot</span>
          </p-message>
        } @else {
          <p-message
            severity="success"
            styleClass="milestone-message">
            <span>All raid vault slots earned this week!</span>
          </p-message>
        }
      </p-card>

      <!-- Add Boss Kill Card -->
      <p-card header="Add Boss Kill" styleClass="add-kill-card">
        <div class="kill-form">
          <div class="form-field">
            <label for="raid">Raid</label>
            <p-select
              id="raid"
              [(ngModel)]="selectedRaid"
              [options]="raidOptions"
              optionLabel="label"
              optionValue="value"
              styleClass="w-full">
            </p-select>
          </div>

          <div class="form-field">
            <label for="boss">Boss</label>
            <p-select
              id="boss"
              [(ngModel)]="selectedBoss"
              [options]="bossOptions()"
              placeholder="Select boss"
              styleClass="w-full">
            </p-select>
          </div>

          <div class="form-field">
            <label for="difficulty">Difficulty</label>
            <p-select
              id="difficulty"
              [(ngModel)]="selectedDifficulty"
              [options]="difficultyOptions"
              optionLabel="label"
              optionValue="value"
              styleClass="w-full">
              <ng-template pTemplate="item" let-option>
                <div class="difficulty-option">
                  <span [style.color]="option.color">{{ option.label }}</span>
                </div>
              </ng-template>
            </p-select>
          </div>

          <div class="form-field">
            <label for="count">Number of Bosses</label>
            <p-inputNumber
              id="count"
              [(ngModel)]="bossCount"
              [min]="1"
              [max]="10"
              [showButtons]="true"
              styleClass="w-full">
            </p-inputNumber>
          </div>

          <p-button
            label="Add Kill"
            icon="pi pi-plus"
            severity="success"
            styleClass="w-full"
            [disabled]="!canAddKill() || loading()"
            (onClick)="onAddRaidKill()">
          </p-button>
        </div>

        @if (!selectedCharacter()) {
          <p-message
            severity="warn"
            styleClass="no-character-warning">
            <span>Select a character to add raid kills</span>
          </p-message>
        }
      </p-card>

      <!-- Difficulty Statistics -->
      <p-card header="Difficulty Progress" styleClass="difficulty-stats-card">
        <div class="difficulty-grid">
          @for (option of difficultyOptions; track option.value) {
            <div class="difficulty-stat">
              <div class="difficulty-header">
                <p-tag
                  [value]="option.label"
                  [severity]="getDifficultySeverity(option.value)"
                  styleClass="difficulty-tag">
                </p-tag>
                <span class="kill-count">{{ getDifficultyCount(option.value) }}</span>
              </div>
              <small class="difficulty-description">
                @switch (option.value) {
                  @case ('LFR') { Looking for Raid }
                  @case ('Normal') { Normal Difficulty }
                  @case ('Heroic') { Heroic Difficulty }
                  @case ('Mythic') { Mythic Difficulty }
                }
              </small>
            </div>
          }
        </div>

        <p-divider></p-divider>

        <div class="overall-stats">
          <div class="overall-stat">
            <span class="stat-label">Highest Difficulty:</span>
            <p-tag
              [value]="highestDifficulty()"
              [severity]="getDifficultySeverity(highestDifficulty())"
              styleClass="highest-difficulty-tag">
            </p-tag>
          </div>

          <div class="overall-stat">
            <span class="stat-label">Vault Quality:</span>
            <p-tag
              [value]="rewardQuality()"
              [severity]="rewardQuality() === 'Mythic' ? 'danger' : 'warn'">
            </p-tag>
          </div>
        </div>
      </p-card>

      <!-- Weekly Statistics -->
      <p-card header="Weekly Statistics" styleClass="weekly-stats-card">
        <div class="stats-grid">
          <div class="stat-item">
            <i class="pi pi-trophy stat-icon"></i>
            <div class="stat-content">
              <span class="stat-value">{{ weeklyStats().totalBosses }}</span>
              <span class="stat-label">Bosses Killed</span>
            </div>
          </div>

          <div class="stat-item">
            <i class="pi pi-home stat-icon"></i>
            <div class="stat-content">
              <span class="stat-value">{{ weeklyStats().uniqueRaids }}</span>
              <span class="stat-label">Raids Cleared</span>
            </div>
          </div>

          <div class="stat-item">
            <i class="pi pi-star stat-icon"></i>
            <div class="stat-content">
              <span class="stat-value">{{ weeklyStats().highestDifficulty }}</span>
              <span class="stat-label">Highest This Week</span>
            </div>
          </div>

          <div class="stat-item">
            <i class="pi pi-percentage stat-icon"></i>
            <div class="stat-content">
              <span class="stat-value">{{ vaultProgress().percentage }}%</span>
              <span class="stat-label">Vault Progress</span>
            </div>
          </div>
        </div>
      </p-card>

      <!-- Recent Kills -->
      @if (currentWeekRaids() && getTotalBossKills() > 0) {
        <p-card header="This Week's Kills" styleClass="recent-kills-card">
          <div class="kills-list">
            @for (activity of currentWeekRaidActivities().slice(0, 10); track activity.id) {
              <div class="kill-item">
                <div class="kill-info">
                  <div class="kill-description">{{ activity.description }}</div>
                  <div class="kill-date">{{ formatDate(activity.date) }}</div>
                </div>

                <div class="kill-actions">
                  @if (activity.vaultSlot) {
                    <p-badge
                      value="Vault"
                      severity="success"
                      size="small">
                    </p-badge>
                  }

                  <p-button
                    icon="pi pi-trash"
                    severity="danger"
                    [text]="true"
                    size="small"
                    pTooltip="Remove kill"
                    (onClick)="onRemoveActivity(activity.id)">
                  </p-button>
                </div>
              </div>
            }
          </div>

          @if (weeklyStats().totalBosses > 10) {
            <p-divider></p-divider>
            <div class="more-kills">
              <span>{{ weeklyStats().totalBosses - 10 }} more kills this week</span>
            </div>
          }
        </p-card>
      } @else {
        <p-card header="This Week's Kills" styleClass="no-kills-card">
          <div class="no-kills">
            <i class="pi pi-trophy"></i>
            <h4>No Raid Kills This Week</h4>
            <p>Start adding your raid boss kills to track your Great Vault progress!</p>
          </div>
        </p-card>
      }

      <!-- Raid Difficulty Guide -->
      <p-panel header="Raid Difficulty Rewards" [toggleable]="true" [collapsed]="true" styleClass="rewards-guide">
        <div class="rewards-info">
          <div class="reward-tier">
            <p-tag value="LFR" severity="success"></p-tag>
            <span class="tier-description">Looking for Raid - Easiest difficulty, basic rewards</span>
          </div>
          <div class="reward-tier">
            <p-tag value="Normal" severity="info"></p-tag>
            <span class="tier-description">Normal - Standard difficulty, good rewards</span>
          </div>
          <div class="reward-tier">
            <p-tag value="Heroic" severity="warn"></p-tag>
            <span class="tier-description">Heroic - High difficulty, Heroic quality vault rewards</span>
          </div>
          <div class="reward-tier">
            <p-tag value="Mythic" severity="danger"></p-tag>
            <span class="tier-description">Mythic - Highest difficulty, Mythic quality vault rewards</span>
          </div>
          <div class="reward-tier">
            <p-tag value="Progress" severity="success"></p-tag>
            <span class="tier-description">Kill 2/4/6 bosses for 1/2/3 vault slots</span>
          </div>
        </div>
      </p-panel>
    </div>
  } @else {
    <div class="no-character">
      <p-card>
        <div class="empty-state">
          <i class="pi pi-user-plus"></i>
          <h3>No Character Selected</h3>
          <p>Select a character to track their raid progress and vault status.</p>
        </div>
      </p-card>
    </div>
  }

  @if (loading()) {
    <div class="loading-overlay">
      <i class="pi pi-spin pi-spinner"></i>
      <span>Updating raid data...</span>
    </div>
  }
</div>