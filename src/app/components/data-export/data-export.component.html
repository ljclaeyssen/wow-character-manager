<!-- Data Export Interface -->
<div class="data-export-container">
  <!-- Header -->
  <p-panel header="Data Export" styleClass="export-panel">
    <ng-template pTemplate="icons">
      <p-button
        icon="pi pi-question-circle"
        [text]="true"
        [rounded]="true"
        severity="secondary"
        pTooltip="Export your character and activity data for backup or transfer"
        tooltipPosition="left">
      </p-button>
    </ng-template>

    <!-- Status Message -->
    @if (exportState().message) {
      <p-message
        [severity]="exportState().messageType!"
        [closable]="true"
        styleClass="export-message"
        (onClose)="dismissMessage()">
        {{ exportState().message }}
      </p-message>
    }

    <!-- Export Options -->
    <div class="export-options">
      <div class="options-header">
        <h4>Select Data to Export</h4>
        <div class="option-actions">
          <p-button
            label="Select All"
            icon="pi pi-check"
            severity="secondary"
            [outlined]="true"
            size="small"
            (onClick)="selectAll()">
          </p-button>
          <p-button
            label="Select None"
            icon="pi pi-times"
            severity="secondary"
            [outlined]="true"
            size="small"
            (onClick)="selectNone()">
          </p-button>
        </div>
      </div>

      <div class="data-type-options">
        <!-- Characters Option -->
        <div class="data-type-option">
          <p-checkbox
            [ngModel]="exportOptions().characters"
            [binary]="true"
            [disabled]="!hasCharacterData()"
            (ngModelChange)="updateExportOption('characters', $event)">
          </p-checkbox>
          <div class="option-content">
            <div class="option-header">
              <i class="pi pi-users option-icon"></i>
              <span class="option-label">Characters</span>
              <p-button
                icon="pi pi-info-circle"
                [text]="true"
                size="small"
                severity="secondary"
                pTooltip="Character profiles: name, race, class, specialization, professions"
                tooltipPosition="right">
              </p-button>
            </div>
            <div class="option-details">
              @if (hasCharacterData()) {
                <span class="data-count">{{ characters().length }} characters available</span>
              } @else {
                <span class="no-data">No character data found</span>
              }
            </div>
          </div>
        </div>

        <!-- Activities Option -->
        <div class="data-type-option">
          <p-checkbox
            [ngModel]="exportOptions().activities"
            [binary]="true"
            [disabled]="!hasActivityData()"
            (ngModelChange)="updateExportOption('activities', $event)">
          </p-checkbox>
          <div class="option-content">
            <div class="option-header">
              <i class="pi pi-calendar option-icon"></i>
              <span class="option-label">Weekly Activities</span>
              <p-button
                icon="pi pi-info-circle"
                [text]="true"
                size="small"
                severity="secondary"
                pTooltip="Current week activity progress: Mythic+, raids, weekly quests"
                tooltipPosition="right">
              </p-button>
            </div>
            <div class="option-details">
              @if (hasActivityData()) {
                <span class="data-count">{{ activityCount() }} activity records available</span>
              } @else {
                <span class="no-data">No activity data found</span>
              }
            </div>
          </div>
        </div>

        <!-- Reset History Option -->
        <div class="data-type-option">
          <p-checkbox
            [ngModel]="exportOptions().resetHistory"
            [binary]="true"
            [disabled]="!hasResetHistory()"
            (ngModelChange)="updateExportOption('resetHistory', $event)">
          </p-checkbox>
          <div class="option-content">
            <div class="option-header">
              <i class="pi pi-history option-icon"></i>
              <span class="option-label">Reset History</span>
              <p-button
                icon="pi pi-info-circle"
                [text]="true"
                size="small"
                severity="secondary"
                pTooltip="Historical weekly reset data and preserved activity records"
                tooltipPosition="right">
              </p-button>
            </div>
            <div class="option-details">
              @if (hasResetHistory()) {
                <span class="data-count">{{ resetHistory().length }} reset records available</span>
              } @else {
                <span class="no-data">No reset history found</span>
              }
            </div>
          </div>
        </div>
      </div>

      <!-- Format Options -->
      <p-divider></p-divider>

      <div class="format-options">
        <h5>Export Options</h5>

        <div class="format-option">
          <p-checkbox
            [ngModel]="exportOptions().includeTimestamps"
            [binary]="true"
            (ngModelChange)="updateExportOption('includeTimestamps', $event)">
          </p-checkbox>
          <div class="format-option-content">
            <span class="format-label">Include Timestamps</span>
            <span class="format-description">Include creation and update dates in export</span>
          </div>
        </div>

        <div class="format-option">
          <p-checkbox
            [ngModel]="exportOptions().formatPretty"
            [binary]="true"
            (ngModelChange)="updateExportOption('formatPretty', $event)">
          </p-checkbox>
          <div class="format-option-content">
            <span class="format-label">Pretty Format</span>
            <span class="format-description">Format JSON with indentation for readability</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Export Summary -->
    @if (selectedDataTypes().length > 0) {
      <p-divider></p-divider>

      <div class="export-summary">
        <h5>Export Summary</h5>
        <div class="summary-content">
          <div class="summary-item">
            <span class="summary-label">Data Types:</span>
            <div class="summary-tags">
              @for (type of selectedDataTypes(); track type) {
                <span class="summary-tag">
                  <i [class]="getDataTypeIcon(type)"></i>
                  {{ type }}
                </span>
              }
            </div>
          </div>
          <div class="summary-item">
            <span class="summary-label">Estimated Size:</span>
            <span class="summary-value">~{{ estimatedSize() }} KB</span>
          </div>
          @if (exportState().lastExportDate) {
            <div class="summary-item">
              <span class="summary-label">Last Export:</span>
              <span class="summary-value">{{ exportState().lastExportDate | date:'medium' }}</span>
            </div>
          }
        </div>
      </div>
    }

    <!-- Export Actions -->
    <p-divider></p-divider>

    <div class="export-actions">
      @if (exportState().isExporting) {
        <!-- Progress Display -->
        <div class="export-progress">
          <div class="progress-content">
            <p-progressSpinner
              [style]="{ width: '32px', height: '32px' }"
              styleClass="progress-spinner">
            </p-progressSpinner>
            <div class="progress-text">
              <span class="progress-message">{{ exportState().message }}</span>
              <span class="progress-percentage">{{ exportState().progress }}%</span>
            </div>
          </div>
          <div class="progress-bar">
            <div
              class="progress-fill"
              [style.width.%]="exportState().progress">
            </div>
          </div>
        </div>
      } @else {
        <!-- Export Button -->
        <div class="export-button-container">
          <p-button
            label="Export Data"
            icon="pi pi-download"
            severity="primary"
            [loading]="exportState().isExporting"
            [disabled]="!canExport()"
            (onClick)="performExport()">
          </p-button>

          @if (!canExport() && selectedDataTypes().length === 0) {
            <span class="action-hint">Select data types to export</span>
          }
          @if (!canExport() && selectedDataTypes().length > 0) {
            <span class="action-hint">No data available for selected types</span>
          }
        </div>
      }
    </div>

    <!-- Help Information -->
    <p-divider></p-divider>

    <div class="export-help">
      <div class="help-content">
        <h6>Export Information</h6>
        <ul class="help-list">
          <li>Exported data is saved as a JSON file with timestamp</li>
          <li>Files can be imported back using the Data Import feature</li>
          <li>Character data includes profiles and profession information</li>
          <li>Activity data contains current week progress only</li>
          <li>Reset history preserves previous weeks' completed activities</li>
          <li>All personal data remains on your device - nothing is uploaded</li>
        </ul>
      </div>
    </div>
  </p-panel>
</div>