<!-- Error Display Component -->
<div class="error-display-container">

  <!-- Inline Error Display -->
  @if (effectiveConfig().mode === 'inline' && hasErrors()) {
    <div class="inline-errors">

      <!-- Error Summary Header -->
      @if (errorCount() > 1) {
        <div class="error-summary">
          <div class="summary-content">
            <i class="pi pi-exclamation-triangle summary-icon"></i>
            <div class="summary-text">
              <span class="summary-title">Multiple Issues Detected</span>
              <span class="summary-details">
                {{ criticalErrors().length }} critical,
                {{ warningErrors().length }} warnings,
                {{ infoErrors().length }} information
              </span>
            </div>
            <div class="summary-actions">
              <p-button
                label="Clear All"
                icon="pi pi-times"
                severity="secondary"
                [outlined]="true"
                size="small"
                (onClick)="clearAllErrors()">
              </p-button>
            </div>
          </div>
        </div>
      }

      <!-- Individual Error Messages -->
      <div class="error-list">
        @for (error of displayErrors(); track error.id) {
          <div class="error-item" [ngClass]="getErrorSeverityClass(error.severity)">

            <!-- Error Header -->
            <div class="error-header">
              <div class="error-main">
                <i [class]="getErrorIcon(error)" class="error-icon"></i>
                <div class="error-content">
                  <div class="error-title-row">
                    <span class="error-title">{{ error.title }}</span>
                    <span class="error-type">{{ getErrorTypeLabel(error.type) }}</span>
                  </div>
                  <p class="error-message">{{ error.message }}</p>
                  @if (effectiveConfig().showTimestamp) {
                    <span class="error-timestamp">{{ formatTimestamp(error.timestamp) }}</span>
                  }
                </div>
              </div>

              <div class="error-actions">
                @if (error.details && effectiveConfig().showDetails) {
                  <p-button
                    [icon]="isErrorExpanded(error.id) ? 'pi pi-chevron-up' : 'pi pi-chevron-down'"
                    [text]="true"
                    [rounded]="true"
                    size="small"
                    severity="secondary"
                    pTooltip="Toggle details"
                    (onClick)="toggleErrorDetails(error.id)">
                  </p-button>
                }

                <p-button
                  icon="pi pi-external-link"
                  [text]="true"
                  [rounded]="true"
                  size="small"
                  severity="secondary"
                  pTooltip="View in modal"
                  (onClick)="showErrorModal(error)">
                </p-button>

                @if (error.dismissible !== false) {
                  <p-button
                    icon="pi pi-times"
                    [text]="true"
                    [rounded]="true"
                    size="small"
                    severity="secondary"
                    pTooltip="Dismiss"
                    (onClick)="dismissError(error.id)">
                  </p-button>
                }
              </div>
            </div>

            <!-- Error Details (Expandable) -->
            @if (error.details && effectiveConfig().showDetails && isErrorExpanded(error.id)) {
              <div class="error-details">
                <p-divider></p-divider>
                <div class="details-content">
                  <h6>Error Details</h6>
                  <pre class="details-text">{{ error.details }}</pre>

                  @if (error.context) {
                    <h6>Context Information</h6>
                    <pre class="context-text">{{ error.context | json }}</pre>
                  }
                </div>
              </div>
            }

            <!-- Recovery Actions -->
            @if (error.recoverable !== false) {
              <div class="error-recovery">
                <p-divider></p-divider>
                <div class="recovery-content">
                  <span class="recovery-title">Suggested Actions:</span>
                  <div class="recovery-actions">
                    @for (action of getRecoveryActions(error); track action.label) {
                      <p-button
                        [label]="action.label"
                        [icon]="action.icon"
                        severity="secondary"
                        [outlined]="true"
                        size="small"
                        (onClick)="action.action()">
                      </p-button>
                    }
                  </div>
                </div>
              </div>
            }
          </div>
        }
      </div>
    </div>
  }

  <!-- Modal Error Display -->
  @if (effectiveConfig().mode === 'modal' || selectedError()) {
    <p-dialog
      [visible]="modalVisible()"
      [modal]="true"
      [draggable]="false"
      [resizable]="false"
      [closable]="true"
      [closeOnEscape]="true"
      styleClass="error-modal"
      (onHide)="hideErrorModal()">

      <ng-template pTemplate="header">
        <div class="modal-header">
          <i [class]="getErrorIcon(selectedError()!)" class="modal-icon"></i>
          <div class="modal-title-section">
            <span class="modal-title">{{ selectedError()?.title }}</span>
            <span class="modal-type">{{ getErrorTypeLabel(selectedError()?.type!) }}</span>
          </div>
        </div>
      </ng-template>

      @if (selectedError()) {
        <div class="modal-content">

          <!-- Error Message -->
          <div class="modal-message">
            <p-message
              [severity]="selectedError()!.severity"
              [closable]="false"
              styleClass="error-message-display">
              {{ selectedError()!.message }}
            </p-message>
          </div>

          <!-- Error Details -->
          @if (selectedError()!.details) {
            <div class="modal-details">
              <h5>Error Details</h5>
              <div class="details-container">
                <pre class="details-content">{{ selectedError()!.details }}</pre>
              </div>
            </div>
          }

          <!-- Context Information -->
          @if (selectedError()!.context) {
            <div class="modal-context">
              <h5>Context Information</h5>
              <div class="context-container">
                <pre class="context-content">{{ selectedError()!.context | json }}</pre>
              </div>
            </div>
          }

          <!-- Timestamp -->
          @if (effectiveConfig().showTimestamp) {
            <div class="modal-timestamp">
              <strong>Occurred:</strong> {{ selectedError()!.timestamp | date:'medium' }}
              <span class="timestamp-relative">({{ formatTimestamp(selectedError()!.timestamp) }})</span>
            </div>
          }
        </div>

        <!-- Modal Actions -->
        <ng-template pTemplate="footer">
          <div class="modal-actions">
            <div class="recovery-actions-modal">
              @for (action of getRecoveryActions(selectedError()!); track action.label) {
                <p-button
                  [label]="action.label"
                  [icon]="action.icon"
                  severity="secondary"
                  [outlined]="true"
                  (onClick)="action.action()">
                </p-button>
              }
            </div>

            <div class="modal-controls">
              @if (selectedError()!.dismissible !== false) {
                <p-button
                  label="Dismiss"
                  icon="pi pi-times"
                  severity="secondary"
                  (onClick)="dismissError(selectedError()!.id); hideErrorModal()">
                </p-button>
              }

              <p-button
                label="Close"
                icon="pi pi-check"
                severity="primary"
                (onClick)="hideErrorModal()">
              </p-button>
            </div>
          </div>
        </ng-template>
      }
    </p-dialog>
  }

  <!-- No Errors State (Optional) -->
  @if (!hasErrors() && effectiveConfig().mode === 'inline') {
    <div class="no-errors-state">
      <div class="no-errors-content">
        <i class="pi pi-check-circle no-errors-icon"></i>
        <span class="no-errors-text">No issues detected</span>
      </div>
    </div>
  }

</div>