<div class="character-list-container">
  <div class="character-list-header">
    <h2>Character List</h2>
    <p-button
      label="Add Character"
      icon="pi pi-plus"
      severity="success"
      (onClick)="onAddCharacter()"
      class="add-character-btn">
    </p-button>
  </div>


  @if (loading()) {
    <div class="loading-container">
      <i class="pi pi-spin pi-spinner loading-icon"></i>
      <span>Loading characters...</span>
    </div>
  } @else if (isEmpty()) {
    <div class="empty-state">
      <i class="pi pi-users empty-icon"></i>
      <h3>No Characters Found</h3>
      <p>Create your first character to get started tracking your WoW progress!</p>
      <p-button
        label="Add Your First Character"
        icon="pi pi-plus"
        severity="success"
        (onClick)="onAddCharacter()">
      </p-button>
    </div>
  } @else {
    <p-table
      [value]="enhancedCharacters()"
      responsiveLayout="scroll"
      class="character-table headerless-table">

      <ng-template pTemplate="body" let-character let-rowIndex="rowIndex">
        <tr [class.selected-row]="selectedCharacter()?.id === character.id">
          <!-- Name and Class with Icon -->
          <td>
            <div class="character-info-cell">
              <img
                [src]="getClassIcon(character.characterClass)"
                [alt]="character.characterClass"
                class="class-icon"
                loading="lazy">
              <div class="character-details">
                <span
                  class="character-name"
                  [style.color]="getClassColor(character.characterClass)"
                  (click)="onCharacterSelect(character)"
                  pTooltip="Click to select character"
                  tooltipPosition="top">
                  {{ character.name }}
                </span>
              </div>
            </div>
          </td>

          <!-- Professions -->
          <td>
            <div class="professions-cell">
              @if (character.professions.length > 0) {
                <div class="profession-icons">
                  @for (profession of character.professions; track profession) {
                    <img
                      [src]="getProfessionIcon(profession)"
                      [alt]="profession"
                      [title]="profession"
                      class="profession-icon"
                      loading="lazy">
                  }
                </div>
              } @else {
                <span class="no-professions">No professions</span>
              }
            </div>
          </td>

          <!-- Vault Progress -->
          <td>
            <div class="vault-progress-cell">
              <div class="vault-progress-summary">
                <span class="vault-slots">{{ character.vaultProgress.total }}/9</span>
                <p-progressBar
                  [value]="character.vaultPercentage"
                  [showValue]="false"
                  class="vault-progress-bar">
                </p-progressBar>
              </div>

              <div class="vault-breakdown">
                <div class="vault-source">
                  <i class="pi pi-trophy"></i>
                  <span>{{ character.vaultProgress.raid }}/3</span>
                </div>
                <div class="vault-source">
                  <i class="pi pi-compass"></i>
                  <span>{{ character.vaultProgress.mythicPlus }}/3</span>
                </div>
                <div class="vault-source">
                  <i class="pi pi-flag"></i>
                  <span>{{ character.vaultProgress.pvp }}/3</span>
                </div>
              </div>
            </div>
          </td>

          <!-- Actions -->
          <td>
            <div class="action-buttons">
              <p-button
                icon="pi pi-pencil"
                severity="info"
                [text]="true"
                size="small"
                pTooltip="Edit Character"
                tooltipPosition="top"
                (onClick)="onEditCharacter(character)">
              </p-button>

              <p-button
                icon="pi pi-trash"
                severity="danger"
                [text]="true"
                size="small"
                pTooltip="Delete Character"
                tooltipPosition="top"
                (onClick)="onDeleteCharacter(character)">
              </p-button>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td [attr.colspan]="columns.length" class="empty-message">
            <div class="empty-state-inline">
              <i class="pi pi-search"></i>
              <span>No characters found matching your search criteria.</span>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  }
</div>