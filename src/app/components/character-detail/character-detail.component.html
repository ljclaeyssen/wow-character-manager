<div class="character-detail-container">
  <div class="character-detail-header">
    <p-button
      icon="pi pi-arrow-left"
      severity="secondary"
      [text]="true"
      size="small"
      pTooltip="Back to character list"
      (onClick)="onClose()"
      class="back-button">
    </p-button>

    <h2 class="character-detail-title">Character Details</h2>

    <div class="character-detail-actions">
      <p-button
        icon="pi pi-pencil"
        label="Edit"
        severity="info"
        size="small"
        (onClick)="onEditCharacter()">
      </p-button>

      <p-button
        icon="pi pi-trash"
        label="Delete"
        severity="danger"
        size="small"
        (onClick)="onDeleteCharacter()">
      </p-button>
    </div>
  </div>

  @if (character()) {
    <div class="character-detail-content">
      <!-- Character Overview Card -->
    <p-card class="character-overview-card">
      <ng-template pTemplate="header">
        <div class="character-card-header">
          <div class="character-basic-info">
            <h3
              class="character-name"
              [style.color]="getClassColor(currentCharacter()!.characterClass)">
              {{ currentCharacter()!.name }}
            </h3>

            <div class="character-subtitle">

              <span class="character-race-class">
                {{ getRaceDisplayName(currentCharacter()!.race) }} {{ currentCharacter()!.characterClass }}
              </span>
            </div>
          </div>

          <div class="character-faction">
            <p-tag
              [value]="currentCharacter()!.faction"
              [severity]="currentCharacter()!.faction === 'Alliance' ? 'info' : 'danger'"
              [icon]="getFactionIcon(currentCharacter()!.faction)"
              class="faction-tag">
            </p-tag>
          </div>
        </div>
      </ng-template>

      <div class="character-overview-content">
        <div class="character-specs-professions">
          <div class="character-specialization">
            <label class="info-label">Specialization:</label>
            <p-chip
              [label]="currentCharacter()!.specialization"
              [style]="{ 'background-color': getClassColor(currentCharacter()!.characterClass) + '20',
                        'color': getClassColor(currentCharacter()!.characterClass) }">
            </p-chip>
          </div>

          @if (currentCharacter()!.professions.length > 0) {
            <div class="character-professions">
              <label class="info-label">Professions:</label>
              <div class="professions-list">
                @for (profession of currentCharacter()!.professions; track profession) {
                  <p-chip [label]="profession" severity="secondary"></p-chip>
                }
              </div>
            </div>
          }
        </div>

        <p-divider></p-divider>

        <!-- Vault Progress Section -->
        <div class="vault-progress-section">
          <h4 class="section-title">
            <i class="pi pi-treasure-chest"></i>
            Great Vault Progress
          </h4>

          <div class="vault-overview">
            <div class="vault-summary">
              <span class="vault-slots-count">{{ vaultProgress().total }}/9 Slots</span>
              <p-progressBar
                [value]="vaultPercentage()"
                [showValue]="true"
                class="vault-progress-bar">
              </p-progressBar>
            </div>
          </div>

          <div class="vault-breakdown">
            <div class="vault-source">
              <div class="source-header">
                <i class="pi pi-trophy source-icon raid-icon"></i>
                <span class="source-label">Raid</span>
              </div>
              <div class="source-progress">
                <span class="source-count">{{ vaultProgress().raid }}/3</span>
                <div class="source-slots">
                  @for (slot of [0, 1, 2]; track slot) {
                    <div
                      class="vault-slot"
                      [class.completed]="slot < vaultProgress().raid"
                      [class.raid-slot]="true">
                    </div>
                  }
                </div>
              </div>
            </div>

            <div class="vault-source">
              <div class="source-header">
                <i class="pi pi-compass source-icon mythic-icon"></i>
                <span class="source-label">Mythic+</span>
              </div>
              <div class="source-progress">
                <span class="source-count">{{ vaultProgress().mythicPlus }}/3</span>
                <div class="source-slots">
                  @for (slot of [0, 1, 2]; track slot) {
                    <div
                      class="vault-slot"
                      [class.completed]="slot < vaultProgress().mythicPlus"
                      [class.mythic-slot]="true">
                    </div>
                  }
                </div>
              </div>
            </div>

            <div class="vault-source">
              <div class="source-header">
                <i class="pi pi-flag source-icon pvp-icon"></i>
                <span class="source-label">PvP</span>
              </div>
              <div class="source-progress">
                <span class="source-count">{{ vaultProgress().pvp }}/3</span>
                <div class="source-slots">
                  @for (slot of [0, 1, 2]; track slot) {
                    <div
                      class="vault-slot"
                      [class.completed]="slot < vaultProgress().pvp"
                      [class.pvp-slot]="true">
                    </div>
                  }
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </p-card>

    <!-- Activity Statistics Card -->
    <p-card class="activity-stats-card">
      <ng-template pTemplate="header">
        <h4 class="card-title">
          <i class="pi pi-chart-bar"></i>
          Activity Statistics
        </h4>
      </ng-template>

      <div class="activity-stats-grid">
        <div class="stat-item">
          <span class="stat-value">{{ activityStats().totalActivities }}</span>
          <span class="stat-label">Total Activities</span>
        </div>

        <div class="stat-item">
          <span class="stat-value">{{ activityStats().weeklyCompleted }}</span>
          <span class="stat-label">This Week</span>
        </div>

        <div class="stat-item">
          <span class="stat-value">{{ activityStats().mythicPlusCompleted }}</span>
          <span class="stat-label">M+ Dungeons</span>
        </div>

        <div class="stat-item">
          <span class="stat-value">{{ activityStats().raidsCompleted }}</span>
          <span class="stat-label">Raid Bosses</span>
        </div>

        <div class="stat-item">
          <span class="stat-value">{{ activityStats().pvpMatches }}</span>
          <span class="stat-label">PvP Matches</span>
        </div>
      </div>
    </p-card>

    <!-- Recent Activities Card -->
    <p-card class="recent-activities-card">
      <ng-template pTemplate="header">
        <h4 class="card-title">
          <i class="pi pi-history"></i>
          Recent Activities
        </h4>
      </ng-template>

      @if (recentActivities().length === 0) {
        <div class="no-activities">
          <i class="pi pi-info-circle"></i>
          <span>No activities recorded yet</span>
        </div>
      } @else {
        <div class="activities-list">
          <div class="no-activities">
            <i class="pi pi-calendar-minus"></i>
            <p>No recent activities found</p>
            <p class="text-muted">Activity tracking will be implemented in a future update</p>
          </div>
        </div>
      }
    </p-card>

    <!-- Character Information Card -->
    <p-card class="character-info-card">
      <ng-template pTemplate="header">
        <h4 class="card-title">
          <i class="pi pi-info-circle"></i>
          Character Information
        </h4>
      </ng-template>

      <div class="character-info-grid">
        <div class="info-row">
          <span class="info-label">Created:</span>
          <span class="info-value">{{ formatDate(currentCharacter()!.createdAt) }}</span>
        </div>

        <div class="info-row">
          <span class="info-label">Last Updated:</span>
          <span class="info-value">{{ formatDate(currentCharacter()!.updatedAt) }}</span>
        </div>

        <div class="info-row">
          <span class="info-label">Character ID:</span>
          <span class="info-value character-id">{{ currentCharacter()!.id }}</span>
        </div>
      </div>
    </p-card>
    </div>
  } @else {
    <div class="character-loading">
      <p>Character not found.</p>
      <p-button
        label="Back to Characters"
        icon="pi pi-arrow-left"
        severity="secondary"
        (onClick)="onClose()">
      </p-button>
    </div>
  }
</div>