<div class="dashboard-container">
  <!-- Dashboard Header -->
  <div class="dashboard-header p-d-flex p-flex-column p-gap-3">
    <div class="header-content p-d-flex p-flex-column p-gap-2">
      <h1>WoW Character Manager</h1>
      <div class="header-stats p-d-flex p-flex-wrap p-gap-3 p-justify-center p-md-justify-start">
        <div class="stat-item p-d-flex p-flex-column p-align-center p-text-center">
          <span class="stat-value">{{ dashboardStats().totalCharacters }}</span>
          <span class="stat-label">Characters</span>
        </div>
        <div class="stat-item p-d-flex p-flex-column p-align-center p-text-center">
          <span class="stat-value">{{ dashboardStats().totalActivities }}</span>
          <span class="stat-label">Weekly Activities</span>
        </div>
        <div class="stat-item p-d-flex p-flex-column p-align-center p-text-center">
          <span class="stat-value">{{ dashboardStats().averageVaultProgress }}%</span>
          <span class="stat-label">Avg Vault Progress</span>
        </div>
        <div class="stat-item p-d-flex p-flex-column p-align-center p-text-center">
          <span class="stat-value">{{ getNextResetTime() }}</span>
          <span class="stat-label">Until Reset</span>
        </div>
      </div>
    </div>

  </div>

  <!-- Main Content Area -->
  <div class="dashboard-main p-d-flex p-flex-column p-gap-4">
    <!-- Character Overview Card -->
    <p-card header="Character Overview" styleClass="character-overview-card">
      @if (characters().length > 0) {

        <!-- Modern Character Cards Grid -->
        <div class="character-grid">
          @for (character of enhancedCharacters(); track character.id) {
            <div
              class="character-card"
              [class.selected]="selectedCharacter()?.id === character.id"
              (click)="onCharacterSelect(character)">

              <!-- Character Header -->
              <div class="character-header">
                <div class="character-avatar">
                  <i class="pi pi-user"></i>
                </div>
                <div class="character-info">
                  <h3 class="character-name" [style.color]="getClassColor(character.characterClass)">
                    {{ character.name }}
                  </h3>
                  <div class="character-meta">
                    <span class="character-class">{{ character.characterClass }}</span>
                    <span class="character-separator">â€¢</span>
                    <span class="character-faction" [class]="character.faction.toLowerCase()">
                      {{ character.faction }}
                    </span>
                  </div>
                </div>
                <div class="character-actions">
                  <button
                    class="action-btn edit-btn"
                    (click)="onEditCharacter(character); $event.stopPropagation()"
                    title="Edit Character">
                    <i class="pi pi-pencil"></i>
                  </button>
                </div>
              </div>

              <!-- Progress Section -->
              <div class="character-progress">
                <!-- Vault Progress -->
                <div class="progress-section vault-section">
                  <div class="progress-header">
                    <div class="progress-title">
                      <i class="pi pi-trophy"></i>
                      <span>Great Vault</span>
                    </div>
                    <div class="progress-value">{{ character.vaultProgress }}/9</div>
                  </div>
                  <div class="progress-bar-container">
                    <div class="progress-bar">
                      <div
                        class="progress-fill"
                        [style.width.%]="character.vaultPercentage"
                        [class.complete]="character.vaultPercentage === 100">
                      </div>
                    </div>
                    <span class="progress-percentage">{{ character.vaultPercentage }}%</span>
                  </div>
                </div>

                <!-- Weekly Activities -->
                <div class="progress-section activities-section">
                  <div class="progress-header">
                    <div class="progress-title">
                      <i class="pi pi-calendar"></i>
                      <span>Weekly Activities</span>
                    </div>
                    <div class="activity-count" [class.active]="character.weeklyActivities > 0">
                      {{ character.weeklyActivities }}
                    </div>
                  </div>
                </div>

                <!-- Last Activity -->
                @if (character.lastActivity) {
                  <div class="last-activity-section">
                    <i class="pi pi-clock"></i>
                    <span>{{ formatRelativeTime(character.lastActivity) }}</span>
                  </div>
                }
              </div>

              <!-- Selection Indicator -->
              <div class="selection-indicator">
                <i class="pi pi-check"></i>
              </div>
            </div>
          }
        </div>
      } @else {
        <div class="no-characters">
          <i class="pi pi-users"></i>
          <h3>No Characters Created</h3>
          <p>Create your first character to start tracking your WoW progress!</p>
          <p-button
            label="View Characters"
            icon="pi pi-users"
            severity="info"
            routerLink="/characters">
          </p-button>
        </div>
      }
    </p-card>

    <!-- Activity Tracking Card -->
    @if (selectedCharacter()) {
      <p-card
        styleClass="activity-tracking-card">

        <wow-activity-tracker
          [selectedCharacter]="selectedCharacter()">
        </wow-activity-tracker>

      </p-card>
    } @else {
      <p-panel header="Select a Character" styleClass="no-selection-panel">
        <div class="no-selection">
          <i class="pi pi-hand-point-up"></i>
          <h3>Select a Character Above</h3>
          <p>Choose a character from the overview to view their detailed activity tracking and progress.</p>
        </div>
      </p-panel>
    }

  </div>


  <!-- Loading States -->
  @if (charactersLoading() || activitiesLoading()) {
    <div class="loading-overlay">
      <i class="pi pi-spin pi-spinner"></i>
      <span>Loading dashboard data...</span>
    </div>
  }
</div>