<p-card class="vault-summary-card" [pTooltip]="getTooltipText()" tooltipPosition="top">
  <ng-template pTemplate="header">
    <div class="summary-header">
      <i class="pi pi-sync vault-icon"></i>
      <div class="header-text">
        <h4 class="vault-title">Synchronized Weekly Vault Progress</h4>
        <span class="reset-info">Resets in {{ timeUntilReset() }}</span>
      </div>
      <p-button
        icon="pi pi-refresh"
        [text]="true"
        size="small"
        pTooltip="Refresh Synchronized Vault Data"
        [loading]="loading()"
        [disabled]="loading()"
        (onClick)="loadSummary()">
      </p-button>
    </div>
  </ng-template>

  <ng-template pTemplate="content">
    <div class="summary-content">
      @if (!isTrackingAvailable()) {
        <div class="api-required">
          <i class="pi pi-exclamation-triangle warning-icon"></i>
          <div class="warning-content">
            @if (hasCredentials()) {
              <span class="warning-text">Authentication Required</span>
              <small class="warning-subtitle">Click to authenticate with Blizzard API</small>
              <p-button
                label="Authenticate"
                icon="pi pi-key"
                size="small"
                [outlined]="true"
                severity="warn"
                [loading]="loading()"
                [disabled]="loading()"
                (onClick)="onSetupAPI()">
              </p-button>
            } @else {
              <span class="warning-text">API Setup Required</span>
              <small class="warning-subtitle">Blizzard API credentials needed for sync</small>
              <p-button
                label="Setup Guide"
                icon="pi pi-info-circle"
                size="small"
                [outlined]="true"
                severity="warn"
                (onClick)="onSetupAPI()">
              </p-button>
            }
          </div>
        </div>
      }

      @else if (loading()) {
        <div class="loading-content">
          <p-skeleton height="1.5rem" class="mb-2"></p-skeleton>
          <p-skeleton height="0.5rem" class="mb-2"></p-skeleton>
          <p-skeleton height="1rem"></p-skeleton>
        </div>
      }

      @else if (summary()) {
        <div class="vault-stats">
          <!-- Synchronized Status -->
          <div class="sync-status">
            <div class="sync-indicator">
              <i class="pi pi-check-circle sync-icon success"></i>
              <span class="sync-text">Synchronized with Blizzard</span>
            </div>
            <small class="last-sync">Last sync: {{ summary()!.lastUpdated | date:'short' }}</small>
          </div>

          <!-- Slots Progress -->
          <div class="stat-row">
            <span class="stat-label">Unlocked Slots</span>
            <p-tag
              [value]="summary()!.totalUnlockedSlots + ' / 9'"
              [severity]="getSlotsSeverity(summary()!.totalUnlockedSlots)"
              styleClass="slots-tag">
            </p-tag>
          </div>

          <!-- Progress Bar -->
          <div class="progress-row">
            <div class="progress-info">
              <span class="progress-label">Weekly Progress</span>
              <span class="progress-percentage">{{ progressPercentage() }}%</span>
            </div>
            <p-progressBar
              [value]="progressPercentage()"
              [showValue]="false"
              styleClass="vault-progress"
              [class]="'progress-' + getProgressSeverity(progressPercentage())">
            </p-progressBar>
          </div>

          <!-- Category Breakdown with Loot Info -->
          <div class="category-breakdown">
            <div class="category-stat">
              <div class="category-header">
                <i class="pi pi-trophy mythicplus-icon"></i>
                <span class="category-count">{{ summary()!.mythicPlusSlots }}/3</span>
              </div>
              @if (summary()!.mythicPlusSlots > 0) {
                <small class="loot-info">Mythic+ Rewards</small>
              }
            </div>

            <div class="category-stat">
              <div class="category-header">
                <i class="pi pi-users raid-icon"></i>
                <span class="category-count">{{ summary()!.raidSlots }}/3</span>
              </div>
              @if (summary()!.raidSlots > 0) {
                <small class="loot-info">Raid Rewards</small>
              }
            </div>

            <div class="category-stat">
              <div class="category-header">
                <i class="pi pi-shield pvp-icon"></i>
                <span class="category-count">{{ summary()!.pvpSlots }}/3</span>
              </div>
              @if (summary()!.pvpSlots > 0) {
                <small class="loot-info">PvP Rewards</small>
              }
            </div>
          </div>

          <!-- Highest Reward Info -->
          @if (summary()!.highestItemLevel > 0) {
            <div class="reward-info">
              <div class="reward-header">
                <i class="pi pi-star-fill reward-icon"></i>
                <span class="reward-label">Best Weekly Reward</span>
              </div>
              <div class="reward-details">
                <span class="reward-ilvl">{{ summary()!.highestItemLevel }} ilvl</span>
                <small class="reward-source">From synchronized activities</small>
              </div>
            </div>
          }

          <!-- Sync Actions -->
          <div class="sync-actions">
            <p-button
              label="Force Sync"
              icon="pi pi-sync"
              size="small"
              [outlined]="true"
              severity="secondary"
              [loading]="loading()"
              [disabled]="loading()"
              (onClick)="loadSummary()">
            </p-button>
          </div>
        </div>
      }

      @else {
        <div class="no-data">
          <i class="pi pi-info-circle info-icon"></i>
          <span class="info-text">No synchronized vault data</span>
        </div>
      }
    </div>
  </ng-template>
</p-card>