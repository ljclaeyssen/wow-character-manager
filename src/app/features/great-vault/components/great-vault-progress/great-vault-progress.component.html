<p-card class="great-vault-card">
  <ng-template pTemplate="header">
    <div class="vault-header">
      <div class="header-content">
        <i class="pi pi-gift vault-icon"></i>
        <div class="header-text">
          <h3 class="vault-title">Great Vault</h3>
          <p class="vault-subtitle">Weekly Rewards Progress</p>
        </div>
      </div>
      <div class="header-actions">
        @if (isTrackingAvailable()) {
          <p-button
            icon="pi pi-refresh"
            [loading]="loading()"
            [disabled]="loading()"
            severity="secondary"
            [outlined]="true"
            size="small"
            (onClick)="onRefresh()"
            pTooltip="Refresh vault progress"
            tooltipPosition="top">
          </p-button>
        }
      </div>
    </div>
  </ng-template>

  <ng-template pTemplate="content">
    <div class="vault-content">
      <!-- API Setup Required -->
      @if (!isTrackingAvailable()) {
        <div class="api-setup-required">
          <p-message
            severity="warn"
            text="Blizzard API credentials required for Great Vault tracking"
            [closable]="false">
          </p-message>
          <p-button
            label="Setup API Access"
            icon="pi pi-cog"
            [loading]="loading()"
            (onClick)="onSetupApi()"
            class="setup-button">
          </p-button>
        </div>
      }

      <!-- Error State -->
      @else if (error()) {
        <div class="error-state">
          <p-message
            severity="error"
            [text]="error()!"
            [closable]="true"
            (onClose)="onClearError()">
          </p-message>
        </div>
      }

      <!-- Loading State -->
      @else if (loading()) {
        <div class="loading-state">
          <div class="loading-summary">
            <p-skeleton height="1.5rem" class="mb-2"></p-skeleton>
            <p-skeleton height="1rem" class="mb-3"></p-skeleton>
          </div>
          <div class="loading-slots">
            @for (slot of [1,2,3]; track slot) {
              <div class="loading-slot">
                <p-skeleton width="120px" height="140px"></p-skeleton>
              </div>
            }
          </div>
        </div>
      }

      <!-- Main Content -->
      @else if (progress()) {
        <div class="vault-progress">
          <!-- Progress Summary -->
          <div class="progress-summary">
            <div class="summary-stats">
              <div class="stat-item">
                <p-tag
                  [value]="summary()!.totalUnlockedSlots + ' / 9 Slots'"
                  [severity]="getSlotsSeverity(summary()!.totalUnlockedSlots)"
                  styleClass="slots-tag">
                </p-tag>
              </div>
              <div class="stat-item">
                <span class="stat-label">Weekly Progress</span>
                <span class="stat-value">{{ progressPercentage() }}%</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">Reset in</span>
                <span class="stat-value">{{ timeUntilReset() }}</span>
              </div>
            </div>

            @if (summary()!.highestItemLevel > 0) {
              <div class="highest-ilvl">
                <span class="ilvl-label">Highest Reward:</span>
                <span class="ilvl-value">{{ summary()!.highestItemLevel }} ilvl</span>
              </div>
            }
          </div>

          <!-- Mythic+ Section -->
          <div class="vault-category">
            <div class="category-header">
              <i class="pi pi-trophy category-icon mythicplus-icon"></i>
              <div class="category-info">
                <h4 class="category-title">Mythic+ Dungeons</h4>
                <p class="category-details">{{ getMythicPlusDetails() }}</p>
              </div>
            </div>
            <div class="category-slots">
              <app-vault-slot [slot]="progress()!.mythicPlus.slot1" [slotNumber]="1"></app-vault-slot>
              <app-vault-slot [slot]="progress()!.mythicPlus.slot2" [slotNumber]="2"></app-vault-slot>
              <app-vault-slot [slot]="progress()!.mythicPlus.slot3" [slotNumber]="3"></app-vault-slot>
            </div>
          </div>

          <p-divider></p-divider>

          <!-- Raid Section -->
          <div class="vault-category">
            <div class="category-header">
              <i class="pi pi-users category-icon raid-icon"></i>
              <div class="category-info">
                <h4 class="category-title">Raids</h4>
                <p class="category-details">{{ getRaidDetails() }}</p>
              </div>
            </div>
            <div class="category-slots">
              <app-vault-slot [slot]="progress()!.raids.slot1" [slotNumber]="4"></app-vault-slot>
              <app-vault-slot [slot]="progress()!.raids.slot2" [slotNumber]="5"></app-vault-slot>
              <app-vault-slot [slot]="progress()!.raids.slot3" [slotNumber]="6"></app-vault-slot>
            </div>
          </div>

          <p-divider></p-divider>

          <!-- PvP Section -->
          <div class="vault-category">
            <div class="category-header">
              <i class="pi pi-shield category-icon pvp-icon"></i>
              <div class="category-info">
                <h4 class="category-title">PvP</h4>
                <p class="category-details">{{ progress()!.pvp.honorEarned | number }} Honor earned</p>
              </div>
            </div>
            <div class="category-slots">
              <app-vault-slot [slot]="progress()!.pvp.slot1" [slotNumber]="7"></app-vault-slot>
              <app-vault-slot [slot]="progress()!.pvp.slot2" [slotNumber]="8"></app-vault-slot>
              <app-vault-slot [slot]="progress()!.pvp.slot3" [slotNumber]="9"></app-vault-slot>
            </div>
          </div>
        </div>
      }

      <!-- No Progress State -->
      @else {
        <div class="no-progress">
          <div class="no-progress-content">
            <i class="pi pi-gift no-progress-icon"></i>
            <h4>No Progress This Week</h4>
            <p>Complete activities to unlock Great Vault rewards.</p>
            <p-button
              label="Refresh"
              icon="pi pi-refresh"
              [outlined]="true"
              (onClick)="onRefresh()">
            </p-button>
          </div>
        </div>
      }
    </div>
  </ng-template>

  <ng-template pTemplate="footer">
    @if (progress() && hasProgress()) {
      <div class="vault-footer">
        <small class="last-updated">
          Last updated: {{ progress()!.lastUpdated | date:'short' }}
        </small>
      </div>
    }
  </ng-template>
</p-card>