<div class="app-shell">
  <!-- Loading Overlay -->
  @if (isLoading()) {
    <div class="loading-overlay">
      <div class="loading-content">
        <p-progressBar mode="indeterminate" [style]="{'height': '6px'}"></p-progressBar>
        <span class="loading-text">Loading...</span>
      </div>
    </div>
  }

  <!-- Main Navigation Toolbar -->
  <app-toolbar
    [title]="title()"
    [version]="version()"
    [menuItems]="menuItems()"
    [stats]="toolbarStats()"
    [state]="toolbarState()"
    (toggleMobileMenu)="toggleMobileSidebar()"
    (clearError)="clearError()">
  </app-toolbar>

  <!-- Mobile Sidebar Navigation -->
  <p-drawer
    [(visible)]="appState().sidebarVisible"
    position="left"
    [modal]="true"
    [dismissible]="true"
    styleClass="mobile-sidebar"
    (onHide)="onSidebarHide()">

    <ng-template pTemplate="header">
      <div class="sidebar-header">
        <div class="sidebar-brand">
          <i class="pi pi-users sidebar-brand-icon"></i>
          <div class="sidebar-brand-content">
            <span class="sidebar-brand-title">{{ title() }}</span>
            <span class="sidebar-brand-version">v{{ version() }}</span>
          </div>
        </div>
      </div>
    </ng-template>

    <ng-template pTemplate="content">
      <div class="sidebar-content">
        <!-- Quick Stats -->
        <div class="sidebar-stats">
          <div class="stat-item">
            <span class="stat-label">Characters</span>
            <span class="stat-value">{{ headerStats().totalCharacters }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Active</span>
            <span class="stat-value">{{ headerStats().activeCharacters }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Vault Slots</span>
            <span class="stat-value">{{ headerStats().totalVaultSlots }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Reset</span>
            <span class="stat-value">{{ headerStats().nextResetTime }}</span>
          </div>
        </div>

        <!-- Mobile Menu Items -->
        <div class="sidebar-menu">
          @for (item of mobileMenuItems(); track item.label) {
            @if (item.disabled) {
              <div class="menu-section-header">
                <i [class]="item.icon"></i>
                <span>{{ item.label }}</span>
              </div>
            } @else {
              <a
                [routerLink]="item.routerLink"
                class="menu-item"
                [class.menu-child-item]="item.styleClass === 'menu-child-item'"
                (click)="item.command && item.command({})">
                <i [class]="item.icon"></i>
                <span>{{ item.label }}</span>
              </a>
            }
          }
        </div>
      </div>
    </ng-template>

    <ng-template pTemplate="footer">
      <div class="sidebar-footer">
        <p-button
          label="Close Menu"
          icon="pi pi-times"
          severity="secondary"
          [text]="true"
          (onClick)="closeMobileSidebar()">
        </p-button>
      </div>
    </ng-template>
  </p-drawer>

  <!-- Error Banner -->
  @if (hasError()) {
    <div class="error-banner">
      <div class="error-content">
        <i class="pi pi-exclamation-triangle error-icon"></i>
        <span class="error-message">{{ hasError() }}</span>
        <p-button
          icon="pi pi-times"
          [text]="true"
          severity="danger"
          size="small"
          (onClick)="clearError()"
          ariaLabel="Dismiss Error">
        </p-button>
      </div>
    </div>
  }

  <!-- Main Content Area -->
  <main class="app-main">
    <div class="main-content">
      <!-- Router Outlet for navigation -->
      <router-outlet></router-outlet>
    </div>
  </main>

  <!-- Global Toast Notifications -->
  <p-toast
    position="top-right"
    [preventOpenDuplicates]="true"
    [preventDuplicates]="true"
    [showTransformOptions]="'translateX(100%)'"
    [hideTransformOptions]="'translateX(100%)'"
    [showTransitionOptions]="'300ms ease-out'"
    [hideTransitionOptions]="'250ms ease-in'">
  </p-toast>

  <!-- Loading Skeletons for Initial Load -->
  @if (charactersLoading() || activitiesLoading()) {
    <div class="skeleton-overlay">
      <div class="skeleton-content">
        @for (item of [1,2,3]; track item) {
          <div class="skeleton-card">
            <p-skeleton height="2rem" class="mb-2"></p-skeleton>
            <p-skeleton height="4rem" class="mb-3"></p-skeleton>
            <div class="flex gap-2">
              <p-skeleton width="5rem" height="1.5rem"></p-skeleton>
              <p-skeleton width="5rem" height="1.5rem"></p-skeleton>
            </div>
          </div>
        }
      </div>
    </div>
  }
</div>

